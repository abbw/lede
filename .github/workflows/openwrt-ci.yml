name: Bulid OpenWrt

on:
  watch:
    types: started

jobs:
  build:
    runs-on: ubuntu-20.04
    if: github.event.repository.owner.id == github.event.sender.id
    
    steps:
    - name: Checkout
      uses: actions/checkout@master
    
    - name: 更新 lede
      run: |
        git pull
        git add .

    - name: 下载 dl 库
      run: |
        # sudo -E apt-get update
        # sudo -E apt-get -y install build-essential asciidoc binutils bzip2 gawk gettext git libncurses5-dev libz-dev patch python3 unzip zlib1g-dev lib32gcc1 libc6-dev-i386 subversion flex uglifyjs gcc-multilib g++-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint device-tree-compiler antlr3 gperf swig
        sed -i 's/#src-git helloworld/src-git helloworld/g' ./feeds.conf.default
        # ./scripts/feeds update -a
        # ./scripts/feeds install -a
        # make defconfig
        # make download -j8
        bash ./dl/large_file_list_gen.sh
        bash ./dl/large_file_split.sh
        cd dl && git add -f . && ls
        bash ./dl/large_file_git_add.sh

    - name: Commit
      run: |
        git config --global user.email 1037886804@qq.com
        git config --global user.name 笨蛋海绵
        git commit -m 'Auto Update' -a

    - name: Push
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
